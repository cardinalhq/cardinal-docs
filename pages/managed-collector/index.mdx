import ManagedCollectorDiagram from "../../components/ManagedCollectorDiagram"

# Managed Collector

Cardinal Managed Collectors are a remotely configurable layer on top of the OpenTelemetry Collector, designed to simplify and streamline how you gather, process, and send telemetry data. By leveraging the Cardinal Managed Collector, you gain operational visibility and control over every stage of your telemetry pipeline—without manually configuring or maintaining collectors across your environment.

## Architecture

The Managed Collector uses a distributed architecture designed for Kubernetes environments, with three collector types working together:

<ManagedCollectorDiagram />

### Collector Types

**Gateway Collector**

The Gateway Collector is the central aggregation point for all telemetry within a Kubernetes cluster. It receives data from Agent and Polling collectors, applies pipeline rules, and forwards processed telemetry to external destinations. The Gateway can simultaneously write to:
- **Lakerunner** (object storage) for long-term retention and analytics
- **OTLP destinations** for real-time monitoring and alerting

**Agent Collector**

Agent Collectors run as a DaemonSet, with one instance on every node in the cluster. They are responsible for:
- Receiving telemetry from pods running on the node (distributing collection workload)
- Monitoring node-level metrics (CPU, memory, disk, network)
- Collecting container logs and system logs
- Forwarding all collected data to the Gateway Collector

By running on each node, Agent Collectors ensure that telemetry collection is distributed and that pods communicate with a local collector, minimizing network overhead.

**Polling Collector**

The Polling Collector handles centralized data collection tasks that should only run once per cluster:
- Scraping Prometheus endpoints
- Querying the Kubernetes API server for cluster metrics
- Collecting Kubernetes events
- Any other polling-based data sources

This prevents duplicate data collection that would occur if every Agent Collector performed these tasks.

## Remote Management

All collector configuration is managed remotely through the [Cardinal UI](https://app.cardinalhq.io). With the Managed Collector, you can:

- **Add or Remove Sources:** Dynamically introduce new data streams or stop unwanted ones—all without touching the underlying infrastructure.
- **Manage Destinations:** Seamlessly re-route telemetry data to different backends at any time.
- **Apply Processing Rules:** Configure transformations, enrichments, or filters with simple configuration changes.

There's no need to redeploy or manually reconfigure collectors—the Managed Collector handles it all remotely and collectors continuously stay up-to-date with the latest configurations.

## Pipeline Rules

Pipeline rules are flexible, user-defined transformations and filters applied to your telemetry data as it passes through the pipeline. Rules help you:

- Control costs by removing unnecessary data
- Enhance data quality by adding tags or extracting metrics
- Improve privacy by masking or dropping sensitive information
- Streamline observability by filtering noise

### Available Rule Types

| Rule Type | Description |
|-----------|-------------|
| **PII Removal/Masking** | Remove or obscure sensitive Personally Identifiable Information |
| **Extract Metrics** | Convert log fields into metrics for aggregation and alerting |
| **Custom OTTL** | Write custom logic using OpenTelemetry Transformation Language |
| **Filter** | Remove telemetry items based on defined conditions |
| **Drop Tags** | Remove high-cardinality tags that inflate cost |
| **Add Tags** | Enrich telemetry with additional context |
| **Sampling** | Reduce volume by sampling logs randomly or proportionally |
| **Extract Tags** | Parse log messages to extract structured tags |

## Observability

The Managed Collector provides granular insights into its own operation:

- **Node Stats:** Track CPU usage, memory consumption, and collector health in real-time
- **Rule Stats:** Monitor how rules affect your data—how much is filtered, how often tags are extracted, sampling effectiveness
- **Pipeline Telemetry:** Understand how data moves through sources, rules, and destinations

## Getting Started

To get started with Managed Collectors:

1. Navigate to **Collector Pipelines** in the [Cardinal UI](https://app.cardinalhq.io)
2. Add your desired [Connectors](/managed-collector/connectors) (sources and destinations)
3. Configure processing rules to shape your telemetry data
4. Deploy collectors using the provided Helm chart
